<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>M√≥n ƒÉn y√™u th√≠ch</title>
    <link rel="stylesheet" href="food.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
<h1>üíñ Danh s√°ch m√≥n ƒÉn y√™u th√≠ch</h1>
<div class="favorite-foods-list"></div>

<script>
    $(document).ready(function () {
        loadFavoriteFoods();
    });

    function loadFavoriteFoods() {
        let favoriteFoods = JSON.parse(localStorage.getItem("favoriteFoods")) || [];

        if (favoriteFoods.length === 0) {
            $(".favorite-foods-list").html("<p>Ch∆∞a c√≥ m√≥n ƒÉn n√†o trong danh s√°ch y√™u th√≠ch.</p>");
            return;
        }

        $(".favorite-foods-list").empty(); // Ch·ªâ x√≥a n·∫øu c√≥ m√≥n ƒÉn

        // üìå G·ªçi API l·∫•y t·∫•t c·∫£ m√≥n ƒÉn y√™u th√≠ch trong m·ªôt l·∫ßn request
        $.ajax({
            url: `http://localhost:8080/api/foods/favorites`, // API h·ªó tr·ª£ l·∫•y nhi·ªÅu ID c√πng l√∫c
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ foodIds: favoriteFoods }), // G·ª≠i m·∫£ng ID l√™n server
            success: function (foods) {
                if (foods.length === 0) {
                    $(".favorite-foods-list").html("<p>Ch∆∞a c√≥ m√≥n ƒÉn n√†o trong danh s√°ch y√™u th√≠ch.</p>");
                    return;
                }

                foods.forEach(food => {
                    let foodItem = `
                        <div class="food-item" data-id="${food.id}">
                            <img src="${food.imageUrl}" alt="${food.name}">
                            <h2>${food.name}</h2>
                            <p>Gi√°: ${formatCurrency(food.price)}</p>
                            <button class="remove-favorite" data-id="${food.id}">‚ùå X√≥a</button>
                        </div>
                    `;
                    $(".favorite-foods-list").append(foodItem);
                });
            },
            error: function () {
                console.error("L·ªói khi t·∫£i danh s√°ch m√≥n ƒÉn y√™u th√≠ch");
            }
        });
    }

    // üõ† X·ª≠ l√Ω x√≥a m√≥n kh·ªèi danh s√°ch y√™u th√≠ch
    $(document).off("click", ".remove-favorite").on("click", ".remove-favorite", function () {
        let foodId = $(this).data("id");
        removeFromFavorites(foodId);
    });

    function removeFromFavorites(foodId) {
        let favoriteFoods = JSON.parse(localStorage.getItem("favoriteFoods")) || [];
        favoriteFoods = favoriteFoods.filter(id => id !== foodId);
        localStorage.setItem("favoriteFoods", JSON.stringify(favoriteFoods));
        loadFavoriteFoods(); // Reload danh s√°ch
    }

    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
    }
</script>
</body>
</html>
